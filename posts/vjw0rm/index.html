<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Vjw0rm" /><meta property="og:locale" content="en" /><meta name="description" content="Vjw0rm" /><meta property="og:description" content="Vjw0rm" /><link rel="canonical" href="https://mahmoud-hashad.github.io/posts/vjw0rm/" /><meta property="og:url" content="https://mahmoud-hashad.github.io/posts/vjw0rm/" /><meta property="og:site_name" content="Mahmoud Ramadan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-14T18:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Vjw0rm" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-14T18:00:00+02:00","datePublished":"2022-07-14T18:00:00+02:00","description":"Vjw0rm","headline":"Vjw0rm","mainEntityOfPage":{"@type":"WebPage","@id":"https://mahmoud-hashad.github.io/posts/vjw0rm/"},"url":"https://mahmoud-hashad.github.io/posts/vjw0rm/"}</script><title>Vjw0rm | Mahmoud Ramadan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mahmoud Ramadan"><meta name="application-name" content="Mahmoud Ramadan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar/avatar.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mahmoud Ramadan</a></div><div class="site-subtitle font-italic">Interested in Malware analysis and reverse engineering</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/mahmoud-hashad" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mahmoud.r.hashad','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/mahmoud-hashad/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Vjw0rm</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Vjw0rm</h1><div class="post-meta text-muted"><div> By <em> <a href="https://www.linkedin.com/in/mahmoud-hashad/">Mahmoud Ramadan</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1657814400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-07-14 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="421 words"> <em>2 min</em> read</span></div></div></div><div class="post-content"><h1 id="vjw0rm">Vjw0rm</h1><p>Sample Url: <a href="https://bazaar.abuse.ch/download/2fcb91ed942cf840ed6e2c38005f26b5bdd3d69488a018e2c23c546a66423638/">https://bazaar.abuse.ch/</a></p><p>We start with a js file the file is obfuscated as shown in the image and at the end is some data that looks like base64 encoded but if you try to decode it directly it will fail.</p><p><img data-src="/assets/img/posts/vjw0rm/1.png" alt="image 1" data-proofer-ignore> <em>Image 1</em></p><p>After using <a href="https://lelinhtinh.github.io/de4js/">de4js</a> to deobfuscate the script and follow looking at its logic it appears to replace each match of <code class="language-plaintext highlighter-rouge">&gt;&lt;</code> on the suspicious base46 with <code class="language-plaintext highlighter-rouge">A</code> the decode it.</p><p><img data-src="/assets/img/posts/vjw0rm/2.png" alt="image 2" data-proofer-ignore> <em>Image 2</em></p><p>and the decoded payload reveals another js script</p><p><img data-src="/assets/img/posts/vjw0rm/3.png" alt="image 3" data-proofer-ignore> <em>Image 3</em></p><p>This script will write a new <code class="language-plaintext highlighter-rouge">js</code> file at the<code class="language-plaintext highlighter-rouge">%APPDATA%/spHAeMTgHF.js</code> and run it the content of the file is the result of decoding base64 data. And will create a new <code class="language-plaintext highlighter-rouge">vbs</code> file at <code class="language-plaintext highlighter-rouge">%TMP%/ejike.vbs</code> and run it the content of the file is the result of decoding base64 data.</p><p>I will start with the <code class="language-plaintext highlighter-rouge">js</code> file it is obfuscated as the first file so by replacing <code class="language-plaintext highlighter-rouge">&gt;&lt;</code> with <code class="language-plaintext highlighter-rouge">A</code> and base64 decode we found another <code class="language-plaintext highlighter-rouge">js</code> script The new script includes some weird naming and needs to be analysed</p><p><img data-src="/assets/img/posts/vjw0rm/4.png" alt="image 4" data-proofer-ignore> <em>Image 4</em></p><p>Cleaning it a bit and we can find what it does. For presistance it uses registry <code class="language-plaintext highlighter-rouge">HKCU\Software\Microsoft\Windows\CurrentVersion\Run\YVBPFHTJIQ\</code> And it copies itself to the startup folder Another registry that is used by this malware is <code class="language-plaintext highlighter-rouge">HKCU\vjw0rm</code></p><p>Then a loop is started to communicate with the C2 in our case it was <code class="language-plaintext highlighter-rouge">http://franmhort[.]duia[.]ro</code> at port <code class="language-plaintext highlighter-rouge">8152</code> and path <code class="language-plaintext highlighter-rouge">Vre/</code></p><p>jvw0rm includes a few commands:</p><ul><li>Cl: terminate the script<li>Sc: write file to <code class="language-plaintext highlighter-rouge">%tmp%</code> dir and run it<li>Ex: eval JScript<li>Rn: overwrite <code class="language-plaintext highlighter-rouge">VN</code> variable with a new value and re-run the script<li>Un: it is not clear but appears to do something related to the registry key <code class="language-plaintext highlighter-rouge">YVBPFHTJIQ</code> could be updated<li>RF: the same as Cl</ul><p>Looking at the <code class="language-plaintext highlighter-rouge">vbs</code> file and it appears that this is the worm it will copy itself to startup, temp folders and add itself to <code class="language-plaintext highlighter-rouge">HKEY_CURRENT_USER\software\microsoft\windows\currentversion\run\&lt;script name&gt;</code> <code class="language-plaintext highlighter-rouge">HKEY_LOCAL_MACHINE\software\microsof\windows\currentversion\run\&lt;script name&gt;</code> then enumerate all files and folders on the system and create a shortcut for them and inject itself to run when each one is used</p><p>the worm provides some ready function like a trojan:</p><ul><li>execute: run vbs scripts<li>uninstall: remove the worm and reverse all that it did [could be used to build removal script]<li>send: download file from c2<li>site-send: download file from any site<li>recv: upload file to c2<li>enum-driver: enumerate drivers<li>enum-faf: enumerate folder<li>enum-process: enumerate processes<li>cmd-shell: start cmd shell<li>delete: delete file or folder<li>exit-process: terminate process<li>sleep: sleep ;)</ul><p>worm c2:</p><ul><li>host: 194.5.97.7<li>port: 4040</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/malware/'>Malware</a>, <a href='/categories/worm/'>worm</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/real-sample/" class="post-tag no-text-decoration" >real_sample</a> <a href="/tags/vbs/" class="post-tag no-text-decoration" >vbs</a> <a href="/tags/js/" class="post-tag no-text-decoration" >js</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Vjw0rm - Mahmoud Ramadan&amp;url=https://mahmoud-hashad.github.io/posts/vjw0rm/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Vjw0rm - Mahmoud Ramadan&amp;u=https://mahmoud-hashad.github.io/posts/vjw0rm/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://mahmoud-hashad.github.io/posts/vjw0rm/&amp;text=Vjw0rm - Mahmoud Ramadan" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/SolarMarker/">SolarMarker</a><li><a href="/posts/redline_stealer/">RedLine Stealer</a><li><a href="/posts/nahamcon_ctf/">NahamCon CTF 2022</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/reverse/">reverse</a> <a class="post-tag" href="/tags/real-sample/">real_sample</a> <a class="post-tag" href="/tags/net/">.net</a> <a class="post-tag" href="/tags/dll/">dll</a> <a class="post-tag" href="/tags/excel/">excel</a> <a class="post-tag" href="/tags/exe/">exe</a> <a class="post-tag" href="/tags/macro/">macro</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/0x32dbg/">0x32dbg</a> <a class="post-tag" href="/tags/js/">js</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/SolarMarker/"><div class="card-body"> <em class="timeago small" data-ts="1683648000" > 2023-05-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SolarMarker</h3><div class="text-muted small"><p> Initial assessment Using pestudio MD5: ed629af9a127724d64185a26d00ae62d File type: 32bit .NET DLL Compiler stamp: Mon Feb 22 17:24:02 2021 | UTC entry point: 0x0002BECE Imports some import...</p></div></div></a></div><div class="card"> <a href="/posts/Unpacking_Loki/"><div class="card-body"> <em class="timeago small" data-ts="1683907200" > 2023-05-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Unpaking Loki</h3><div class="text-muted small"><p> Initial Assessment Sample Info: MD5: b66eb4bcb2860ef48afbc1378e1ae545 File Type: PE32 Compiler Time Stamp: 2016-03-29 23:03:35 Sections contains abnormal section name Imports a lot of susp...</p></div></div></a></div><div class="card"> <a href="/posts/redline_stealer/"><div class="card-body"> <em class="timeago small" data-ts="1653840000" > 2022-05-29 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RedLine Stealer</h3><div class="text-muted small"><p> Overview Sample URL: bazaar.abuse RedLine is a stealer malware that collects all information about the victim as passwords and credit card numbers. In this analysis, the goal is to discover the c...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/emu8068_1/" class="btn btn-outline-primary" prompt="Older"><p>Patching emu8086</p></a> <a href="/posts/litctf-You_Know_The_Rules_And_So_Do_I/" class="btn btn-outline-primary" prompt="Newer"><p>LIT CTF - rev/You Know The Rules And So Do I</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> Â© 2023 <a href="https://www.linkedin.com/in/mahmoud-hashad/">Mahmoud Ramadan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/reverse/">reverse</a> <a class="post-tag" href="/tags/real-sample/">real_sample</a> <a class="post-tag" href="/tags/net/">.net</a> <a class="post-tag" href="/tags/dll/">dll</a> <a class="post-tag" href="/tags/excel/">excel</a> <a class="post-tag" href="/tags/exe/">exe</a> <a class="post-tag" href="/tags/macro/">macro</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/0x32dbg/">0x32dbg</a> <a class="post-tag" href="/tags/js/">js</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
